// Generated by CoffeeScript 1.4.0
(function() {

  $(document).ready(function() {
    var aggregateCMValues, aggregateHValues;
    aggregateCMValues = function() {
      var microshelter;
      microshelter = {};
      microshelter.name = $('#cmName').val();
      microshelter.capacity = $('#cmCapacity').val();
      microshelter.description = $('#cmCapacity').val();
      microshelter.lat = 23.3232;
      microshelter.long = 73.2323;
      return JSON.stringify(microshelter);
    };
    aggregateHValues = function() {
      var pwnia;
      pwnia = {};
      pwnia.name = $('#hName').val();
      pwnia.description = $('#hCapacity').val();
      pwnia.fl = $('#checkbox-2').is(":checked");
      pwnia.sf = $('#checkbox-3').is(":checked");
      pwnia.el = $('#checkbox-4').is(":checked");
      pwnia.fi = $('#checkbox-5').is(":checked");
      pwnia.td = $('#checkbox-6').is(":checked");
      pwnia.sd = $('#checkbox-7').is(":checked");
      pwnia.lat = 23.3232;
      pwnia.long = 73.2323;
      return JSON.stringify(pwnia);
    };
    $('#submitHelp').on('click', function() {
      $.mobile.loading('show', {
        text: 'submitting your request...',
        textVisible: true,
        theme: 'a',
        html: ""
      });
      return $.ajax('https://api.mongolab.com/api/1/databases/sandy/collections/pwnia?apiKey=50958597e4b0268b29eee111', {
        type: 'POST',
        contentType: 'application/json',
        data: aggregateHValues(),
        error: function(jqXHR, textStatus, errorThrown) {
          return alert("AJAX Error: " + textStatus + ", " + errorThrown);
        },
        success: function(data, textStatus, jqXHR) {
          $.mobile.loading('hide');
          return $("#hRequestInfo").popup("open");
        }
      });
    });
    $('#submitCreateMicroFilter').on('click', function() {
      $.mobile.loading('show', {
        text: 'submitting your request...',
        textVisible: true,
        theme: 'a',
        html: ""
      });
      return $.ajax('https://api.mongolab.com/api/1/databases/sandy/collections/microshelters?apiKey=50958597e4b0268b29eee111', {
        type: 'POST',
        contentType: 'application/json',
        data: aggregateCMValues(),
        error: function(jqXHR, textStatus, errorThrown) {
          return alert("AJAX Error: " + textStatus + ", " + errorThrown);
        },
        success: function(data, textStatus, jqXHR) {
          $.mobile.loading('hide');
          return $("#msRequestInfo").popup("open");
        }
      });
    });
    return $('#shelterButton').on('click', function() {
      var map, mapOptions, refreshMap;
      $.mobile.loading('show', {
        text: 'Loading shelters near you',
        textVisible: true,
        theme: 'a',
        html: ""
      });
      mapOptions = {
        zoom: 10,
        center: new google.maps.LatLng(40.716843, -73.989514),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
      refreshMap = function() {
        google.maps.event.trigger(map, 'resize');
        return map.panTo(new google.maps.LatLng(40.716843, -73.989514));
      };
      google.maps.event.addListenerOnce(map, 'idle', refreshMap);
      setTimeout(refreshMap, 300);
      return $.getJSON('https://api.mongolab.com/api/1/databases/sandy/collections/shelters?apiKey=50958597e4b0268b29eee111', function(data) {
        return $.each(data, function(i, help) {
          var infowindow, latLng, marker;
          latLng = new google.maps.LatLng(help.lat, help.long);
          marker = new google.maps.Marker({
            map: map,
            animation: google.maps.Animation.DROP,
            position: latLng
          });
          infowindow = new google.maps.InfoWindow({
            content: help.popserved
          });
          return google.maps.event.addListener(marker, 'click', function() {
            return infowindow.open(map, marker);
          });
        });
      });
    });
  });

}).call(this);
